<% _.each(suite.features, function(feature, featureIndex) { %>
    <% var uid = guid() %>
    <% if (featureIndex === 0 || featureIndex % 2 === 0) { %>
    <div class="row my-1" xmlns="http://www.w3.org/1999/html">
    <% } %>
    <div class="col-6 feature feature-<%= feature.scenarios.failed ? 'failed' : 'passed' %>">
        <div class="card">
            <div class="card-body py-2">
                <small class="text-muted"><%= feature.tags.map(a => a.name).join('&nbsp;') %></small>
                <h4 class="card-title m-0">
                <a data-toggle="collapse" href="#collapseFeature<%= suite.name.sanitized %><%= uid %>">
                    <i class="fas fa-chevron-right"></i>
                    <i class="fas fa-chevron-down"></i>
                    <b><%= feature.keyword %>:</b> <%= feature.name %>
                    <div class="float-right">
          <% if (feature.scenarios.passed) { %><span class="badge badge-success"
                                                     title="<%= feature.scenarios.passed %> Scenarios Passed"><%= feature.scenarios.passed %></span><% } %>
          <% if (feature.scenarios.failed) { %><span class="badge badge-danger"
                                                     title="<%= feature.scenarios.failed %> Scenarios Failed"><%= feature.scenarios.failed %></span><% } %>
          <% if (feature.scenarios.notdefined) { %><span class="badge badge-info"
                                                         title="<%= feature.scenarios.notdefined %> Scenarios Undefined"><%= feature.scenarios.notdefined %></span><% } %>
          <% if (feature.scenarios.pending) { %><span class="badge badge-secondary"
                                                      title="<%= feature.scenarios.pending %> Scenarios Pending"><%= feature.scenarios.pending %></span><% } %>
          <% if (feature.scenarios.skipped) { %><span class="badge badge-warning"
                                                      title="<%= feature.scenarios.skipped %> Scenarios Skipped"><%= feature.scenarios.skipped %></span><% } %>
          <% if (feature.scenarios.ambiguous) { %><span class="badge badge-primary"
                                                        title="<%= feature.scenarios.ambiguous %> Ambiguous Scenarios"><%= feature.scenarios.ambiguous %></span><% } %>
                    </div>
                </a>
            </h4>
              </div>
            <ul id="collapseFeature<%= suite.name.sanitized %><%= uid %>" class="list-group list-group-flush feature-collapse collapse">
                    <% if (feature.description) { %>
                    <li class="list-group-item description"><%= feature.description.replace(/\n/g, '<br/>') %></li>
                    <% } %>
                    <% _.each(feature.elements, function(element, scenarioIndex) { %>
                    <% var scenarioId = guid(); %>
                    <li class="list-group-item">
                        <% var scenarioTagsOnly = feature.tags ? _.drop(element.tags, feature.tags.length) : element.tags %>
                        <small class="text-muted"><%= scenarioTagsOnly.map(a => a.name).join('&nbsp;') %></small>
                        <h4 class="card-title m-0">
                                <a data-toggle="collapse" href="#collapseScenario<%= suite.name.sanitized %><%= scenarioId %>">
                                    <i class="fas fa-chevron-right"></i>
                                    <i class="fas fa-chevron-down"></i>
                                    <b><%= element.keyword %>:</b> <%= element.name %>
                                    <div class="float-right">
                              <% if (element.passed) { %><span class="badge badge-success"
                                                               title="<%= element.passed %> Steps Passed"><%= element.passed %></span><% } %>
                              <% if (element.notdefined) { %><span class="badge badge-info"
                                                                   title="<%= element.notdefined %> Steps Undefined"><%= element.notdefined %></span><% } %>
                              <% if (element.pending) { %><span class="badge badge-secondary"
                                                                title="<%= element.pending %> Steps Pending"><%= element.pending %></span><% } %>
                              <% if (element.skipped) { %><span class="badge badge-warning"
                                                                title="<%= element.skipped %> Steps Skipped"><%= element.skipped %></span><% } %>
                              <% if (element.failed) { %><span class="badge badge-danger"
                                                               title="<%= element.failed %> Steps Failed"><%= element.failed %></span><% } %>
                              <% if (element.ambiguous) { %><span class="badge badge-primary"
                                                                  title="<%= element.ambiguous %> Ambiguous Steps"><%= element.ambiguous %></span><% } %>
                                    <div><small><i><%= element.timestamp %></i></small></div>
                                    </div>
                                </a>
                            </h4>
                        <div id="collapseScenario<%= suite.name.sanitized %><%= scenarioId %>"
                             class="scenario-collapse collapse">
                                <div><%= element.notes %></div>
                                <% if (element.description) { %>
                                <div class="description" id="scenario-description"><%=
                                    element.description.trim().replace(/\n/g, '<br/>') %>
                                </div>
                                <% } %>
                                <% _.each(element.steps, function(step, stepIndex) { %>
                                <% if(!step.hidden || step.image || step.text || (step.result && step.result.status === 'failed')) { %>
                                <div>
                                    <% if(step.result) { %>
                                        <% if(step.result.status === 'passed') { %>
                                        <span class="text-success" title="Success"><i
                                                class="fas fa-check-square"></i></span>
                                        <% } else if(step.result.status === 'failed') { %>
                                        <span class="text-danger" title="Failed"><i
                                                class="fas fa-times-square"></i></span>
                                        <% } else if(step.result.status === 'skipped') { %>
                                        <span class="text-warning" title="Skipped"><i
                                                class="fas fa-minus-square"></i></span>
                                        <% } else if(step.result.status === 'ambiguous') { %>
                                        <span class="text-primary" title="Ambiguous"><i
                                                class="fas fa-question-circle"></i></span>
                                        <% } else if(step.result.status === 'pending') { %>
                                        <span class="text-default" title="Pending"><i
                                                class="fas fa-exclamation-circle"></i></span>
                                        <% } else { %>
                                        <span class="text-info" title="Undefined"><i
                                                class="fas fa-flask"></i></span>
                                        <% } %>
                                    <% } %>
                                    <span class="text-black-50"><%= step.keyword %></span>
                                    <span> <%- step.name %></span>
                                      <% if (step.doc_string && step.doc_string.value) { %>
                                          <span>
                                           <%- step.doc_string.value %>
                                          </span>
                                      <% } %>
                                      <% if (step.result) { %>
                                              <span class="text-muted float-right">
                                                   <%= calculateDuration(step.result.duration) %>
                                              </span>
                                        <% } %>
                                      <% if(step.arguments) { %>
                                    <% for( var i = 0; i < step.arguments.length; i++ ) { %>
                                       <% if(step.arguments[i]["rows"]) { %>
                                        <div class="scrollBar">
                                            <table class="arguments">
                                            <% var rows = step.arguments[i]["rows"]; %>
                                              <tr>
                                              <% var cells = rows[0]["cells"]; %>
                                              <% for( var k = 0; k < cells.length; k++ ) { %>
                                                <th>
                                                  <%= cells[k] %>
                                                </th>
                                                 <% } %>
                                                </tr>
                                            <% for( var j = 1; j < rows.length; j++ ) { %>
                                              <tr>
                                              <% var cells = rows[j]["cells"]; %>
                                              <% for( var k = 0; k < cells.length; k++ ) { %>
                                                <td>
                                                  <%= cells[k] %>
                                                </td>
                                              <% } %>
                                              </tr>
                                            <% } %>
                                          </table>
                                       </div>
                                        <% } %>
                                       <% if(step.arguments[i]["content"]) { %>
                                       <pre class="info"><br><%= step.arguments[i]["content"].replace(new RegExp('<', 'g'), '(').replace(new RegExp('>', 'g'), ')') %></pre>
                                       <% } %>

                                    <% } %>
                                  <% } %>
                                      <% if(step.rows) { %>
                                    <% var headers = step.rows[0]["cells"] %>
                                        <div class="scrollBar">
                                            <table class="arguments">
                                                <thead>
                                                    <tr>
                                                        <% for(var i = 0; i < headers.length; i++) { %>
                                                            <th><%= headers[i] %></th>
                                                        <% } %>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <% for(var i = 1; i < step.rows.length; i++) { %>
                                                        <% var cell = step.rows[i]["cells"]; %>
                                                        <tr>
                                                            <% for(var c = 0; c < cell.length; c++) { %>
                                                                <td>
                                                                    <%= cell[c] %>
                                                                </td>
                                                            <% } %>
                                                        </tr>
                                                    <% } %>
                                                </tbody>
                                            </table>
                                        </div>
                                  <% } %>
                                <% if(step.result) { %>

                                <% if (step.result.error_message) { %>
                                    <a href="#error<%= featureIndex %>_<%= scenarioIndex %><%= stepIndex %>"
                                       data-toggle="collapse" class="toggle">Show Error +</a>
                                    <div id="error<%= featureIndex %>_<%= scenarioIndex %><%= stepIndex %>"
                                         class="collapse">
                                        <pre class="info show-modal"
                                             data-toggle="modal"
                                             style="cursor: pointer"
                                             data-target="#error-modal-<%= featureIndex %>_<%= scenarioIndex %><%= stepIndex %>">
                                            <br> <%= step.result.error_message.replace(/</g, '(').replace(/>/g, ')') %></pre>
                                    </div>

                                <div class="modal fade" id="error-modal-<%= featureIndex %>_<%= scenarioIndex %><%= stepIndex %>" tabindex="-1" role="dialog"
                                     aria-badgeledby="stacktraceModalbadge" aria-hidden="true">
                                    <div class="modal-dialog modal-lg">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal"
                                                        aria-badge="Close"><span aria-hidden="true">&times;</span>
                                                </button>
                                                <h4 class="modal-title" id="error-modal-title">
                                                    Error
                                                </h4>
                                            </div>
                                            <div class="modal-body">
                                                <h5>
                                                    <pre><br><%= step.result.error_message.replace(/</g, '(').replace(/>/g, ')') %></pre>
                                                </h5>
                                            </div>

                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-default" data-dismiss="modal">
                                                    Close
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                        <% } %>

                                <% if (step.text) { %>
                                    <a href="#info<%= featureIndex %>_<%= scenarioIndex %><%= stepIndex %>"
                                       data-toggle="collapse" class="show-info toggle">Show Info +</a>
                                    <div id="info<%= featureIndex %>_<%= scenarioIndex %><%= stepIndex %>"
                                         class="collapse"
                                         data-toggle="modal"
                                         style="cursor: pointer"
                                         data-target="#info-modal-<%= featureIndex %>_<%= scenarioIndex %><%= stepIndex %>">
                                        <pre class="info show-modal"><%= step.text %></pre>
                                    </div>

                                <div class="modal fade" id="info-modal-<%= featureIndex %>_<%= scenarioIndex %><%= stepIndex %>" tabindex="-1" role="dialog"
                                     aria-badgeledby="stacktraceModalbadge" aria-hidden="true">
                                    <div class="modal-dialog modal-lg">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal"
                                                        aria-badge="Close"><span aria-hidden="true">&times;</span>
                                                </button>
                                                <h4 class="modal-title" id="info-modal-title">
                                                    Info
                                                </h4>
                                            </div>
                                            <div class="modal-body">
                                                <h5>
                                                    <pre><%= step.text %></pre>
                                                </h5>
                                            </div>

                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-default" data-dismiss="modal">
                                                    Close
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <% } %>

                                <% if (step.image) { %>
                                <a href="#ss<%= featureIndex %>_<%= scenarioIndex %><%= stepIndex %>"
                                    data-toggle="collapse" class="toggle">Screenshot +</a>
                                <div id="ss<%= featureIndex %>_<%= scenarioIndex %><%= stepIndex %>"
                                    class="screenshot collapse">
                                    <pre class="info show-modal"
                                        data-toggle="modal"
                                        style="cursor: pointer"
                                        data-target="#ss-modal-<%= featureIndex %>_<%= scenarioIndex %><%= stepIndex %>">

                                        <img class="screenshot" style="height:100%;width:100%;display:block;"
                                        id="ss-image-<%= featureIndex %>_<%= scenarioIndex %><%= stepIndex %>" src="<%= step.image %>"/>
                                </div>
                                <div class="screenshot collapse"
                                   style="cursor: pointer"

                                   data-toggle="modal"
                                   data-target="#ss-modal-<%= featureIndex %>_<%= scenarioIndex %><%= stepIndex %>">

                                </div>

                                <div class="modal fade" id="ss-modal-<%= featureIndex %>_<%= scenarioIndex %><%= stepIndex %>" tabindex="-1" role="dialog"
                                     aria-badgeledby="stacktraceModalbadge" aria-hidden="true">
                                    <div class="modal-dialog modal-lg">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal"
                                                        aria-badge="Close"><span aria-hidden="true">&times;</span>
                                                </button>
                                                <h4 class="modal-title" id="ss-modal-title">
                                                    Screenshot
                                                </h4>
                                            </div>

                                            <div class="modal-body">
                                                <img class="screenshot" style="height:100%;width:100%;"
                                                     id="my-ss-images" src="<%= step.image %>"/>
                                            </div>

                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-default" data-dismiss="modal">
                                                    Close
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <% } %>

                                <% } %>
                                </div>
                            <% } %>
                            <% }); %>
                        </div>
                    </li>
                    <% }); %>
            </ul>
        </div>
    </div>
    <% if ((featureIndex != 0 && ((featureIndex + 1) % 2 == 0)) || (featureIndex === (suite.features.length -1))) { %>
    </div>
    <% } %>
<% }); %>
